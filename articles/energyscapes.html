<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title> • energyscapes</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">energyscapes</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/energyscapes.html">Get started</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/energyscape-of-top-predator.html">Energyscape of top predator</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/CLambert1/energyscapes/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1></h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/CLambert1/energyscapes/blob/main/vignettes/energyscapes.Rmd" class="external-link"><code>vignettes/energyscapes.Rmd</code></a></small>
      <div class="d-none name"><code>energyscapes.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="energyscapes-estimating-top-predator-energyscapes-and-biomass-consumption">energyscapes: Estimating top predator energyscapes and biomass
consumption<a class="anchor" aria-label="anchor" href="#energyscapes-estimating-top-predator-energyscapes-and-biomass-consumption"></a>
</h2>
<p>The goal of energyscapes is to estimate the field metabolic rate of
marine top predator species. Combining FMR with body mass distribution
data, abundance and SST through allometric relationships, the package
permits estimating the total energyscape for a species, that is the
spatialised energetic needs of the total population. Furthermore, this
energyscape can be used in combination with diet composition and prey
energy content information to estimate the total biomass of prey
necessary for a top predator population to sustain its needs.</p>
<p>The package uses Monte Carlo simulations to build posterior
distributions of parameters and propagate uncertainty from the various
sources throughout the analyses into the final estimations.</p>
<div class="section level3">
<h3 id="set-up-data">Set up data<a class="anchor" aria-label="anchor" href="#set-up-data"></a>
</h3>
<p>The package contains some example data, they can be loaded with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/CLambert1/energyscapes" class="external-link">energyscapes</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sjmgarnier.github.io/viridis/" class="external-link">viridis</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: viridisLite</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"diet"</span>, <span class="st">"species_abundance"</span>, <span class="st">"sst"</span>, <span class="st">"weight"</span>, <span class="st">"map_coords"</span>, <span class="st">"beta"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>These data represents the various elements needed for the analyses
for the particular case of the Scopoli’s shearwaters in the
Mediterranean Sea: the distribution of body mass in the population, the
map of abundance (from Lambert et al 2024 ICES JMS;
10.1093/icesjms/fsae058), the map of SST (only useful for fish species;
retrieved from the E.U. Copernicus Marine Service, product ”MEDSEA
MULTIYEAR PHY 006 004”, <a href="https://doi.org/10.25423/CMCC/MEDSEA" class="external-link uri">https://doi.org/10.25423/CMCC/MEDSEA</a> MULTIYEAR PHY 006
004 E3R1), the diet composition (from Granadeiro et al 1998 MEPS,
10.3354/meps166267), the coordinates of the map and the distribution of
beta parameter used in the allometric equation.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="va">weight</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"Body mass distribution in the population"</span><span class="op">)</span></span></code></pre></div>
<p><img src="energyscapes_files/figure-html/example-1.png" width="100%"></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">species_abundance</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">mean</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html" class="external-link">scale_fill_viridis</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"H"</span><span class="op">)</span></span></code></pre></div>
<p><img src="energyscapes_files/figure-html/example-2.png" width="100%"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">sst</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">mean</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html" class="external-link">scale_fill_viridis</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"H"</span><span class="op">)</span></span></code></pre></div>
<p><img src="energyscapes_files/figure-html/example-3.png" width="100%"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">diet</span><span class="op">)</span> <span class="co"># see ?diet for the detail about table structure</span></span>
<span><span class="co">#&gt; tibble [7 × 11] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ Predator_key         : chr [1:7] "CALDIO" "CALDIO" "CALDIO" "CALDIO" ...</span></span>
<span><span class="co">#&gt;  $ Latin_name           : chr [1:7] "Scomberesocidae" "Macrorhamphosus sp" "Capros aper" "Trachurus sp" ...</span></span>
<span><span class="co">#&gt;  $ pW                   : num [1:7] 24.9 17.2 21.2 7.7 3.8 0.2 25.1</span></span>
<span><span class="co">#&gt;  $ Source_diet          : chr [1:7] "Granadeiro et al 1998 MEPS" "Granadeiro et al 1998 MEPS" "Granadeiro et al 1998 MEPS" "Granadeiro et al 1998 MEPS" ...</span></span>
<span><span class="co">#&gt;  $ Common_name          : chr [1:7] "Atlantic saury" "Snipefish" "Boarfish" "Horse mackerel" ...</span></span>
<span><span class="co">#&gt;  $ Energy_content       : num [1:7] 5.8 5.7 6.2 6 7.9 4.3 4.4</span></span>
<span><span class="co">#&gt;  $ Estimate_level       : chr [1:7] "species" "group" "species" "species" ...</span></span>
<span><span class="co">#&gt;  $ Family               : chr [1:7] "Scomberesocidae" "Centriscidae" "Caproidae" "Carangidae" ...</span></span>
<span><span class="co">#&gt;  $ Taxonomic_group      : chr [1:7] "Teleost" "Teleost" "Teleost" "Teleost" ...</span></span>
<span><span class="co">#&gt;  $ Functional_group     : chr [1:7] "Pelagic fish" "Demersal fish" "Demersal fish" "Pelagic fish" ...</span></span>
<span><span class="co">#&gt;  $ Source_energy_content: chr [1:7] "Spitz et al 2010 ICES JMS" "Spitz et al 2010 ICES JMS" "Spitz et al 2010 ICES JMS" "Spitz et al 2010 ICES JMS" ...</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="run-the-analysis">Run the analysis<a class="anchor" aria-label="anchor" href="#run-the-analysis"></a>
</h3>
<p>From these data, we use the main function of the package
(<code><a href="../reference/mc_simulation.html">mc_simulation()</a></code>) to run the Monte Carlo simulations and
estimate the energyscape and biomass consumptions:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># test mc_simulation() with 2 prey levels</span></span>
<span><span class="va">CALDIO_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mc_simulation.html">mc_simulation</a></span><span class="op">(</span>predator_name <span class="op">=</span> <span class="st">"CALDIO"</span>, </span>
<span>                               predator_group <span class="op">=</span> <span class="st">"Procellariform"</span>,</span>
<span>             map_coordinates <span class="op">=</span> <span class="va">map_coords</span>,</span>
<span>             prey_taxonomic_level <span class="op">=</span> <span class="st">"Taxonomic_group"</span>, </span>
<span>             diet <span class="op">=</span> <span class="va">diet</span>, </span>
<span>             assimilation_rate <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>             n_days <span class="op">=</span> <span class="fl">30</span><span class="op">+</span><span class="fl">31</span><span class="op">+</span><span class="fl">31</span>,</span>
<span>             predator_weight <span class="op">=</span> <span class="va">weight</span>, </span>
<span>             abundance_map <span class="op">=</span> <span class="va">species_abundance</span>, </span>
<span>             temperature_map <span class="op">=</span> <span class="va">sst</span><span class="op">)</span></span>
<span><span class="co">#&gt; Computing Teleost for CALDIO</span></span>
<span><span class="co">#&gt; Computing Crustacea for CALDIO</span></span>
<span><span class="co">#&gt; Computing Cephalopoda for CALDIO</span></span>
<span><span class="co">#&gt; Wrapping up</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">CALDIO_result</span>, max.level <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 8</span></span>
<span><span class="co">#&gt;  $ FMR_map              :'data.frame':   5720 obs. of  8 variables:</span></span>
<span><span class="co">#&gt;  $ Energyscape          :'data.frame':   5720 obs. of  12 variables:</span></span>
<span><span class="co">#&gt;  $ DailyRation          :'data.frame':   3 obs. of  6 variables:</span></span>
<span><span class="co">#&gt;  $ DailyRationPropBM    :'data.frame':   3 obs. of  6 variables:</span></span>
<span><span class="co">#&gt;  $ Conso                :'data.frame':   3 obs. of  6 variables:</span></span>
<span><span class="co">#&gt;  $ DailyRation_map      :'data.frame':   17160 obs. of  8 variables:</span></span>
<span><span class="co">#&gt;  $ DailyRationPropBM_map:'data.frame':   17160 obs. of  8 variables:</span></span>
<span><span class="co">#&gt;  $ Conso_map            :'data.frame':   17160 obs. of  8 variables:</span></span></code></pre></div>
<p>This function returns a bunch of objects:</p>
<ul>
<li>Maps of FMR and energyscape, but also the spatialised daily ration
(expressed as is or as proportion of body mass) and the spatialised
biomass consumption.</li>
<li>Tables summarising the daily ration (for one individual, again raw
or as proportion of body mass) and the total consumption, per prey
category.</li>
</ul>
<p>All estimated values comes with mean, standard deviation, lower 10%
and upper 90% of the posterior distribution from the Monte Carlo
simulation.</p>
<p>An example of estimated consumption:
<img src="energyscapes_files/figure-html/plot-1.png" width="100%"><img src="energyscapes_files/figure-html/plot-2.png" width="100%"></p>
<p>The code is automated so that the diet items can be sorted by
taxonomy (prey_taxonomic_level = “Taxonomic_group”), by functional
groups (prey_taxonomic_level = “Functional_group”), by family
(prey_taxonomic_level = “Family”) or by any relevant grouping variable
(prey_taxonomic_level must be a column in the diet dataframe).</p>
<p>I also created a custom color palette to be used for plotting results
from the above functions. The palette matches the EcoScope project
graphic templates and is ggplot2 friendly
(<code>scale_fill_ecoscope</code> and
<code>scale_color_ecoscope</code>).</p>
<pre><code><span><span class="co">#&gt; Computing Pelagic fish for CALDIO</span></span>
<span><span class="co">#&gt; Computing Demersal fish for CALDIO</span></span>
<span><span class="co">#&gt; Computing Zooplankton for CALDIO</span></span>
<span><span class="co">#&gt; Computing Pelagic cephalopod for CALDIO</span></span>
<span><span class="co">#&gt; Wrapping up</span></span></code></pre>
<p><img src="energyscapes_files/figure-html/plot2-1.png" width="100%"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Charlotte Lambert.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
